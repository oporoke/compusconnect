
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Student {
  id             String    @id
  name           String
  grade          String
  section        String
  discipline     DisciplinaryRecord[]
  invoices       Invoice[]
  grades         Grade[]
  attendance     AttendanceRecord[]
  libraryTransactions LibraryTransaction[]
  canteenAccount CanteenAccount?
  healthRecord   HealthRecord?
  menteeMentorships Mentorship[] @relation("Mentee")
  hostelRoom     Room?     @relation(fields: [hostelRoomId], references: [id])
  hostelRoomId   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model DisciplinaryRecord {
  id          String   @id
  date        DateTime
  reason      String
  actionTaken String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId   String
}

model Exam {
  id      String   @id
  name    String
  date    DateTime
  subjects String[]
  grades  Grade[]
}

model Grade {
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId String
  exam      Exam    @relation(fields: [examId], references: [id], onDelete: Cascade)
  examId    String
  scores    Json

  @@id([studentId, examId])
}

model AttendanceRecord {
  id        Int      @id @default(autoincrement())
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId String
  date      DateTime
  present   Boolean
}

model Staff {
  id                  String   @id
  name                String
  role                String
  department          String
  email               String   @unique
  phone               String
  joiningDate         DateTime
  salary              Float
  leavesTaken         Int
  leavesAvailable     Int
  performanceNotes    String?
  taxDeduction        Float
  insuranceDeduction  Float
  schoolId            String
  assignedAssets      Asset[]
  payrollRecords      PayrollRecord[]
  routes              Route[]
}

model Asset {
  id           String    @id
  name         String
  type         String
  status       String
  assignedTo   Staff?    @relation(fields: [assignedToId], references: [id])
  assignedToId String?
  purchaseDate DateTime
}

model Admission {
  id             String   @id
  name           String
  age            Int
  previousSchool String
  grade          String
  parentName     String
  parentEmail    String
  date           DateTime
  status         String
  documents      Json
}

model FeeStructure {
  id     String   @id
  name   String
  amount Float
  grades String[]
}

model Invoice {
  id        String    @id
  student   Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId String
  date      DateTime
  dueDate   DateTime
  items     Json
  total     Float
  status    String
  payments  Payment[]
}

model Payment {
  id        String   @id @default(cuid())
  invoice   Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoiceId String
  amount    Float
  date      DateTime
  method    String
}

model PayrollRecord {
  id           String   @id @default(cuid())
  staff        Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  staffId      String
  month        String
  grossSalary  Float
  deductions   Float
  netSalary    Float
  date         DateTime
}

model Expense {
  id          String   @id @default(cuid())
  category    String
  description String
  amount      Float
  date        DateTime
}

model Announcement {
  id       String   @id
  title    String
  date     DateTime
  content  String
  schoolId String
}

model Event {
  id          String   @id
  title       String
  date        DateTime
  description String
}

model Conversation {
  id        String    @id
  members   String[]
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Message {
  id             String       @id @default(cuid())
  sender         String
  content        String
  timestamp      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  conversationId String
}

model Book {
  id           String               @id
  rfid         String               @unique
  title        String
  author       String
  subject      String
  isbn         String               @unique
  quantity     Int
  available    Int
  transactions LibraryTransaction[]
}

model LibraryTransaction {
  id        String   @id
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId String
  book      Book     @relation(fields: [bookId], references: [id])
  bookId    String
  type      String
  date      DateTime
  dueDate   DateTime?
}

model Vehicle {
  id       String  @id
  model    String
  capacity Int
  lat      Float
  lng      Float
  route    Route?
}

model Driver {
  id            String @id
  name          String
  licenseNumber String
  contact       String
  route         Route?
}

model Route {
  id        String   @id
  name      String
  stops     Json
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id])
  vehicleId String   @unique
  driver    Driver   @relation(fields: [driverId], references: [id])
  driverId  String   @unique
}

model Hostel {
  id       String @id
  name     String
  capacity Int
  rooms    Room[]
}

model Room {
  id        String    @id
  number    String
  capacity  Int
  hostel    Hostel    @relation(fields: [hostelId], references: [id])
  hostelId  String
  occupants Student[]
}

model CanteenAccount {
  id           String               @id @default(cuid())
  student      Student              @relation(fields: [studentId], references: [id])
  studentId    String               @unique
  balance      Float
  transactions CanteenTransaction[]
}

model CanteenTransaction {
  id               String         @id
  canteenAccount   CanteenAccount @relation(fields: [canteenAccountId], references: [id])
  canteenAccountId String
  studentId        String // Denormalized for easier querying
  type             String
  amount           Float
  description      String
  date             DateTime
}

model CanteenMenuItem {
  id    Int    @id @default(autoincrement())
  name  String @unique
  price Float
  stock Int
}

model AlumniProfile {
  id             String       @id
  name           String
  graduationYear Int
  email          String       @unique
  phone          String
  occupation     String
  company        String
  donations      Donation[]
  mentorMentorships Mentorship[] @relation("Mentor")
}

model Donation {
  id        String        @id @default(cuid())
  alumni    AlumniProfile @relation(fields: [alumniId], references: [id])
  alumniId  String
  amount    Float
  purpose   String
  date      DateTime
}

model Mentorship {
  id        String        @id
  mentor    AlumniProfile @relation("Mentor", fields: [mentorId], references: [id])
  mentorId  String
  mentee    Student       @relation("Mentee", fields: [menteeId], references: [id])
  menteeId  String
  startDate DateTime
  status    String
}

model HealthRecord {
  id           String   @id @default(cuid())
  student      Student  @relation(fields: [studentId], references: [id])
  studentId    String   @unique
  bloodGroup   String
  allergies    String[]
  vaccinations Json
  clinicVisits ClinicVisit[]
}

model ClinicVisit {
  id           String       @id
  healthRecord HealthRecord @relation(fields: [healthRecordId], references: [id])
  healthRecordId String
  studentId    String // Denormalized
  reason       String
  treatment    String
  date         DateTime
}

model Assignment {
  id       String   @id @default(cuid())
  title    String
  subject  String
  dueDate  DateTime
  status   String
}

model CourseMaterial {
  id      String @id @default(cuid())
  subject String
  title   String
  type    String
  link    String
}

model OnlineClass {
  id      String @id @default(cuid())
  subject String
  topic   String
  time    String
  link    String
}
